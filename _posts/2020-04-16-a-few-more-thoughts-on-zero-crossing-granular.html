---
layout: post
title: A few more thoughts on zero-crossing granular processing
date: '2020-04-16T17:42:14+02:00'
tags: []
tumblr_url: https://dariosanfilippo.tumblr.com/post/615568359477641216/a-few-more-thoughts-on-zero-crossing-granular
---
<p>As it often happens, you start the implementation of an algorithm that initially seems to be straightforward and eventually a number of challenges emerge, making the implementation more difficult and intriguing.</p><p>This is what happened to me with the implementation of a windowless granulator based on zero-crossing (ZC) detection and delay lines. I will briefly summarise the main points below, depicting what seems to be a fairly advanced stage of the implementation that has given good results.</p><ul><li>The content of a delay line of size <i>L </i>can be static: such delay line should be filled with the output of a feedback loop of period <i>L</i> that is, in turn, filled with an input signal <i>x. </i>The gains of the input signal and feedback path are mutually exclusive to transition from live to looped inputs.</li><li>For a given pitch shift and time transposition factors, the complement of such factors determines the slopes of line functions that are used, respectively, to modulate the delay and to offset the delay start.</li><li>For proper continuity in the signal, both the end of the current grain and the beginning of the next one must at a ZC.</li><li>For proper continuity in the signal, both the derivatives at the end of the current grain and at the beginning of the next one must have the same sign.</li><li>For proper continuity in the signal, the position of the next grain must be corrected to avoid the repetition of samples – two samples at a ZC. </li><li>The sample position correction can be obtained as the ratio between the derivatives at the end and the beginning of grains. This prevents the derivative of the signal to suddenly change in sign when transitioning from a high-rate grain to a slower-rate one.</li><li>Negative pitch transposition factors result in grains being read backwards, which in turn result in a change of sign in the derivative of the signal. This must be taken into account to select the next grains with the right derivative sign, and the right direction for the sample position correction – either forward or backward.</li></ul>
